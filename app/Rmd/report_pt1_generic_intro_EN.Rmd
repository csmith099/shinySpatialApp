---
title: "Reproducible Report for internal DFO use only: DRAFT"
subtitle: {{u_text}}
author: "Report generated by: {{u_name}} ({{u_email}})"
date: '`r format(Sys.time(), "%d %B, %Y")`'
output:
  html_document:
    theme: paper
    toc: yes
  pdf_document:
    toc: yes
  word_document:
    toc: yes
---

<!-- FROM DUMMY.Rmd -->

```{r Define Site name, echo=FALSE, include=FALSE, cache=FALSE}
# KC: This should not be done as this removes objects (including function) used
# in the app and that may be used in the Rmd. Unless you have a specific reason
# to do so I would argue against using this  here. 
# rm(list=ls(all=TRUE)) 
AquaSiteName <- "FarmersLedge"
PEZversion <- "4748m"
minYear <- 2002
cat(AquaSiteName)
```

```{r setup and libraries, echo=FALSE, include=FALSE, cache=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning=FALSE, message=FALSE, fig.align="left")
library(knitr)
library(rgdal)
library(maps)
library(lubridate)
library(sp)
```

<!-- KC: this is done on application load  -->
<!-- ```{r source functions, echo=FALSE, include=FALSE, cache=FALSE}
source("../R/site_map.r")
source("../R/plot_wsdb.r")
source("../R/filter_wsdb.r")
``` -->

```{r Set up paths, echo=FALSE, include=FALSE, cache=FALSE}
### Paths modified for local set up
dataPath <- file.path("../data/Zones", paste0(AquaSiteName, PEZversion))
polyPath <- "../data/Zones/"
### Paths modified for network set up
#dataPath <- file.path("\\\\ent.dfo-mpo.ca\\ATLShares\\Science\\BIODataSvc\\SRC\\Reproducible_Reporting/data/Zones", paste0(AquaSiteName, PEZversion))
#polyPath <- "\\\\ent.dfo-mpo.ca\\ATLShares\\Science\\BIODataSvc\\SRC\\Reproducible_Reporting/data/Zones"
#wsdbFile <- "\\\\ent.dfo-mpo.ca\\ATLShares\\Science\\BIODataSvc\\SRC\\Reproducible_Reporting\\data\\MarWSDBSightingsForCGomez_27Oct2020.csv"

wsdbFile <- file.path("../data/NaturalResources/Species/Cetaceans/WSDB","MarWSDBSightingsForCGomez_27Oct2020.csv")
wsdb <- read.csv(wsdbFile)
wsdb <- wsdb[which(wsdb$YEAR>=minYear),]
wsdb_filter <- filter_wsdb(wsdb)
```

```{r Select Search Area, echo=FALSE, include=FALSE, cache=FALSE}
# Search Area generated interactively by the app!
studyArea <- as(st_read("{{path_to_geoms}}"), "Spatial")
# site <- readOGR(polyPath,layer=paste0("Site_",AquaSiteName)) #old, static selection
```

```{r read baseline data for maps, echo=FALSE, include=FALSE, cache=FALSE}
landGDB <- "../data/Boundaries/Coast50k/Coastline50k.gdb"
#landGDB <- "\\\\ent.dfo-mpo.ca\\ATLShares\\Science\\BIODataSvc\\SRC\\Reproducible_Reporting\\data\\Boundaries\\Coast50K\\Coastline50k.gdb"
land <- readOGR(dsn=landGDB,layer="Land50k_Maritimes",stringsAsFactors=F)
```

```{r Fig 4 INTERACTIVE TEST Plot Whale Sightings Database - interactive test!, fig.height=8, fig.width=11}
#interactivity! 
#par(mfrow = c(1,2), mar=c(0, 0, 5.5, 0) + 2)#it goes c(bottom, left, top, right)
#site_map(studyArea, site, land, 5)
#plot_wsdb(studyArea, wsdb_filter, 5)
```

<!-- END  -->

<!-- MAIN SECTIONS -->

# **REPRODUCIBLE REPORTING**  

#### **Comments provided by user** 

{{u_comments}}

#### **About this report**

This document summarizes regional data, including information on species and habitats, available at the time of report creation. Data summaries and products (e.g., plots and tables) are presented with source descriptions, caveats, disclaimers, sources of uncertainty, references to the literature, and contacts of relevant staff who can provide further interpretation. This report streamlines the process of generating science information and advice relevant to a variety of cross-sectoral departmental assessments, regulatory reviews, and reporting activities.

This document is developed as a reproducible reporting tool, supported by the R markdown language and generated by an R-Shiny application interface hosted on the DFO network. Report summaries and outputs are based on data extracted from a user-provided search area (a focal polygon of interest) with a user-defined buffer (Figure x). Instructions for use of the R-Shiny interface are provided in the technical manual. Due to the potential sensitivity of some data and information, access to the data in the application has to be granted, and the report is intended for internal use only. 

````{r Fig 1 PEZ polygon, fig.height=8, fig.width=11}
# KC: this is a way of getting the center of a searching area and make it a sp object
site <- SpatialPoints(coordinates(studyArea), studyArea@proj4string)
# KC: this is your map but note that site is no longer used in code
site_map(studyArea, site, land, 40)
```
*Figure 1. Map showing the search area defined by the user: location of the proposed project/activity is highlighted in yellow (input polygon), surrounded by an exposure zone or user-defined buffer area in blue. Buffer area is used by this tool to query information and automatically generate a report.* 

Species that have been listed by the _Species At Risk Act_ (SARA), assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC), or included in the Wild Species listings, are the current focus of this reproducible reporting framework. Recognizing the importance of considering ecosystem-based approaches for management, this report also includes information on other (e.g., commercial, recreational, ecologically significant) species, ecosystem components (e.g., coastal habitat), and areas designated for spatial planning (e.g., Ecologically and Biologically Significant Areas) for each user-defined area. 

The output from the search includes the following sections: 

1) Information from the National Aquatic Species At Risk Program,
2) Fish and Invertebrates,
3) Cetaceans,
4) Habitat,
5) Areas designated for spatial planning.

#### **How to use this report?**  

-	This document must be circulated to all staff identified as contacts (provided in the report) for each data source to ensure the veracity of inference drawn from the report, and to provide any supplemental information that may support the provision of science advice. Users can also request additional data and/or metadata directly from each contact. 
-	This report is intended for internal DFO use only. Privacy screening (i.e., the rule of 5) is not yet integrated into all data products and summaries generated by the report.  
-	The absence of a species in this report should be interpreted as an absence of observation or reporting of the species in the focal area, not necessarily as a true absence of the species. 
-	The focus of this report is on available observations of species presence and not on absences, quantities (e.g., species abundance or biomass), frequency, or catch information. 
-	Because coastal areas of the Scotian Shelf bioregion are generally not adequately sampled to characterize fine-scale ecological characteristics (i.e., species, habitat composition and variability within a sub-regional focal area), the distribution of (some) species featured within the report, when the focal area is near to the coast, should be used as a first-order estimate limited by the spatial-temporal resolution of available data.

This report incorporates information from a variety of sources with differing levels of quality control. Consequently, data sources in the report are categorized into tiers of data quality, and associated usage recommendations (Table x). 

# **SEARCH RESULTS**

#### **EMPHASIS ON SPECIES LISTED BY THE <i>SPECIES AT RISK ACT</i>, ASSESSED BY THE COMMITTEE ON THE STATUS OF THE ENDANGERED WILDLIFE IN CANADA (COSEWIC) AND/OR WILD SPECIES**  

_Table x. Definitions relevant for species listed by Species At Risk Act (SARA), assessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC), or included in the Wild Species listings._ 

{{add_main_sections}}

<!-- HABITAT -->
{{add_appendix}}

<!-- EBSA -->
{{add_ebsa_section}}

<!-- GENERIC END -->

# **REFERENCES**

# **CONTRIBUTORS**

...



